{% load static %}


{% block content %}

  <!-- Main content -->
  <div class="max-w-7xl mx-auto flex mt-8 px-6 gap-6">

    <!-- Sidebar Filters -->
    <aside class="w-1/4 bg-white rounded-xl shadow p-5 h-fit">
      <h2 class="font-semibold text-lg mb-4">Filters</h2>

      <!-- Price Range -->
      <form method="get" id="filterForm">
        <div class="mb-5">
          <h3 class="font-medium mb-2">Price Range</h3>
          <div class="flex items-center gap-2">
            <input type="number" name="min_price" value="{{ request.GET.min_price }}" placeholder="Min" class="w-1/2 border rounded-lg px-2 py-1">
            <input type="number" name="max_price" value="{{ request.GET.max_price }}" placeholder="Max" class="w-1/2 border rounded-lg px-2 py-1">
          </div>
        </div>

        <!-- Country -->
        <div class="mb-5">
          <h3 class="font-medium mb-2">Country</h3>
          <div class="flex flex-col gap-2 text-sm">
            {% for country in countries %}
              {% comment %} <label>
                <input type="checkbox" name="country" value="{{ country }}" 
                       {% if country in request.GET.getlist('country') %}checked{% endif %} class="mr-2">
                {{ country }}
              </label> {% endcomment %}
            {% endfor %}
          </div>
        </div>

        <!-- Brand -->
        <div class="mb-5">
          <h3 class="font-medium mb-2">Brand</h3>
          <div class="flex flex-col gap-2 text-sm">
            {% for brand in brands %}
              {% comment %} <label>
                <input type="checkbox" name="brand" value="{{ brand.id }}"
                       {% if brand.id|stringformat:"s" in request.GET.getlist('brand') %}checked{% endif %} class="mr-2">
                {{ brand.name }}
              </label> {% endcomment %}
            {% endfor %}
          </div>
        </div>

        <!-- Discount -->
        <div class="flex items-center gap-2">
          <input type="checkbox" name="discount" {% if request.GET.discount %}checked{% endif %}>
          <span class="text-sm">Products with discount</span>
        </div>

        <button type="submit" class="mt-5 w-full bg-green-600 text-white py-2 rounded-lg hover:bg-green-700">Apply Filters</button>
        <a href="{% url 'catalog' %}" class="mt-2 block w-full text-center border border-gray-300 py-2 rounded-lg hover:bg-gray-100">Clear Filters</a>
      </form>
    </aside>

    <!-- Product Grid -->
    <section class="flex-1">
      <div class="flex items-center justify-between mb-4">
        <h2 class="text-xl font-semibold">{{ category.name|default:"Coffee" }}</h2>

        <form method="get" class="flex items-center gap-2">
          {% for key, value in request.GET.items %}
            {% if key != 'sort' %}
              <input type="hidden" name="{{ key }}" value="{{ value }}">
            {% endif %}
          {% endfor %}
          <select name="sort" class="border rounded-lg px-3 py-1 text-sm" onchange="this.form.submit()">
            <option value="">Sort by</option>
            <option value="price_asc" {% if request.GET.sort == 'price_asc' %}selected{% endif %}>Price: Low to High</option>
            <option value="price_desc" {% if request.GET.sort == 'price_desc' %}selected{% endif %}>Price: High to Low</option>
            <option value="newest" {% if request.GET.sort == 'newest' %}selected{% endif %}>Newest</option>
          </select>
        </form>
      </div>

      <!-- Grid -->
      {% if products %}
        <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
          {% for product in products %}
            <div class="bg-white rounded-xl shadow hover:shadow-lg transition p-4 flex flex-col">
              <a href="{% url 'product_detail' product.slug %}">
                <img src="{{ product.image.url }}" alt="{{ product.name }}" class="rounded-md mb-3 w-full h-48 object-cover">
              </a>
              <h3 class="font-medium mb-1 truncate">{{ product.name }}</h3>
              <p class="text-sm text-gray-500 mb-2">{{ product.brand.name }}</p>
              {% if product.discount_price %}
                <p class="font-semibold text-green-700 mb-1">₦{{ product.discount_price|floatformat:2 }}</p>
                <p class="text-xs text-gray-400 line-through mb-3">₦{{ product.price|floatformat:2 }}</p>
              {% else %}
                <p class="font-semibold text-green-700 mb-3">₦{{ product.price|floatformat:2 }}</p>
              {% endif %}
              <form method="post" action="{% url 'add_to_cart' product.id %}" class="mt-auto">
                {% csrf_token %}
                <button type="submit" class="bg-green-600 text-white rounded-lg py-2 hover:bg-green-700 w-full">Add to Cart</button>
              </form>
            </div>
          {% endfor %}
        </div>
      {% else %}
        <p class="text-gray-500 mt-8">No products found for your filters.</p>
      {% endif %}

      <!-- Pagination -->
      {% if is_paginated %}
        <div class="flex items-center justify-between mt-8">
          <p class="text-sm text-gray-600">Showing {{ page_obj.start_index }}–{{ page_obj.end_index }} of {{ page_obj.paginator.count }}</p>
          <div class="flex gap-2">
            {% if page_obj.has_previous %}
              <a href="?page={{ page_obj.previous_page_number }}{{ query_string }}" class="px-3 py-1 border rounded-lg hover:bg-gray-100">&laquo;</a>
            {% endif %}
            {% for i in page_obj.paginator.page_range %}
              {% if i == page_obj.number %}
                <span class="px-3 py-1 border rounded-lg bg-green-600 text-white">{{ i }}</span>
              {% else %}
                <a href="?page={{ i }}{{ query_string }}" class="px-3 py-1 border rounded-lg hover:bg-gray-100">{{ i }}</a>
              {% endif %}
            {% endfor %}
            {% if page_obj.has_next %}
              <a href="?page={{ page_obj.next_page_number }}{{ query_string }}" class="px-3 py-1 border rounded-lg hover:bg-gray-100">&raquo;</a>
            {% endif %}
          </div>
        </div>
      {% endif %}
    </section>
</div>



{% endblock content %}
