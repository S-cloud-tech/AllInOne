<form id="otpForm">
  <input type="email" id="email" placeholder="Enter your email" required class="input" />
  <input type="text" id="otp" placeholder="Enter OTP" required class="input" />
  <button type="submit">Verify</button>
</form>
<p class="text-sm mt-3 text-gray-600">
  Didn't get the code?
  <button id="resendOtp" class="text-green-600 hover:underline">Resend OTP</button>
</p>

<script>
// OTP handler
document.getElementById('otpForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    const data = {
        email: document.getElementById('email').value,
        otp: document.getElementById('otp').value
    };

    const res = await fetch('/users/verify-otp/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(data)
    });
    const result = await res.json();
    if (res.ok) {
        alert(result.message);
        window.location.href = "{% url 'users:login' %}";
    } else {
        alert(result.detail || 'Invalid OTP.');
    }
});

// Resend OTP handler
document.getElementById('resendOtp').addEventListener('click', async function() {
    const email = document.getElementById('email').value;
    if (!email) return alert("Please enter your email first.");

    const res = await fetch('/users/resend-otp/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email })
    });

    const result = await res.json();
    if (res.ok) {
        alert(result.message);
    } else {
        alert(result.detail || 'Error resending OTP.');
    }
});
</script>
